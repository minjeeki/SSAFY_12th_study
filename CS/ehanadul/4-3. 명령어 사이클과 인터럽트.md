# Chapter4-3. CPU의 작동원리-명령어 사이클과 인터럽트

# 04-3. 명령어 사이클과 인터럽트

명령어 사이클 : 하나의 명령어를 처리하는 정형화된 흐름

인터럽트 : CPU는 정해진 흐름에 따라 명령어를 처리해 나가지만, 간혹 이 흐름이 끊어지는 상황

## 명령어 사이클(instruction cycle)

= 프로그램 속 각각의 명령어들이 일정하게 실행되는 주기

1. 인출 사이클(fetch cycle) :메모리에 있는 명령어를 CPU로 가져오는 단계
    1. IF. 명령어를 인출하여 CPU로 가져와도, 곧바로 실행할 수 없는 경우 → `간접 사이클(indirect cycle)`
2. `실행 사이클(execution cycle)` : CPU로 가져온 명령어를 실행하는 단계
    1. 제어장치가 명령어 레지스터에 담긴 값을 해석하고, 제어 신호 발생
3. 1,2번 반복

## 인터럽트(interrupt)

= **CPU의 신호를 방해하는 신호**

- 동기 이터럽트
- 비동기 인터럽트
    - 막을 수 있는 인터럽트
    - 막을 수 없는 인터럽트

- 인터럽트 요청 신호 : **CPU의 작업을 방해하는 인터럽트에 대한 요청**
- 인터럽트 플래그 : **인터럽트 요청 신호를 받아들일지 무시할지를 결정하는 비트**
- 인터럽트 벡터 : **인터럽트 서비스 루틴의 시작 주소를 포함하는 인터럽트 서비스 루틴의 식별 정보**
- 인터럽트 서비스 루틴 : **인터럽트를 처리하는 프로그램**

> **동기 인터럽트**(synchronous interrupts)
>

---

CPU에 의해 발생하는 인터럽트

- CPU가 명령어들을 수행하다가 예상치 못한 상황에 마주쳤을 때,
  예를 들어 CPU가 실행하는 프로그래밍상의 오류와 같은 예외적인 상황에 마주쳤을 때 발생하는 인터럽트
- 동기 인터럽트는 예외(exception)라고 부름

> **비동기 인터럽트(asynchronous interrupts)**
>

---

주로 입출력장치에 의해 발생하는 인터럽트

입출력장치에 의해 의한 비동기 인터럽트는 세탁기 완료 알림, 전자레인지 조리 완료 알림과 같은 알림 역할

- CPU가 프린터와 같은 입출력장치에 입출력 작업을 ㅂ탁하면 작업을 끝낸 입출력장치가 CPU에 완료 알림(인터럽트)를 보냄
- 키보드, 마우스와 같은 입출력장치가 어떠한 입력을 받아들였을 때 이를 처리하기 위해 CPU에 입력 알림(인터럽트)를 보냄
- 일반적으로 비동기 인터럽트를 **인터럽트**라고 함, 그러나 아래로 쭉 `하드웨어 인터럽트` 용어 사용

---

> **하드웨어 인터럽트**
>

---

알림과 같은 인터럽트

- CPU는 입출력 작업 도중에도 효율적으로 명령어를 처리하기 위해 알림과 같은 하드웨어 인터럽트를 사용함
- 하드웨어 인터럽트를 이용하면 CPU는 주기적으로 입출력장치(프린트) 완료 여부를 확인할 필요가 없음
- CPU는 입출력장치(프린트)로부터 완료 인터럽트를 받을 때 까지 다른 작업을 처리할 수 있음
- 하드웨어 인터럽트는 입출력 작업 중에도 CPU로 하여금 효율적으로 명령어를 처리할 수 있게 함

- CPU가 하드웨어 인터럽트를 처리하는 순서

  (1) 입출력장치는 CPU에  **인터럽트 요청 신호** 를 보냄

  (2) CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인함

  (3) CPU는 인터럽트 요청을 확인하고 **인터럽트 플래그**를 통해 현재 인터럽트를 받아들일 수 있는지 여부 확인

  (4) 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업함

  (5) CPU는 **인터럽트 벡터**를 참조하여 **인터럽트 서비스 루틴**을 실행함

  (6) 인터럽트 서비스 루틴 실행이 끝나면 (4)에서 백업해둔 작업을 복구하여 실행을 재개함


---

### 예외

- 폴트 : 예외를 처리한 직후 예외 처리가 발생한 명령어부터 실행을 재개하는 예외
- 트랩 : 예외를 처리한 직후 예외가 발생한 명령어의 다음 명령어부터 실행을 재개하는 예외
    - ex) 디버깅
        - 특정 코드가 실행되는 순간 프로그램을 실행을 멈추게 할 수 있음

          → 예외가 발생한 명령어의 다음 명령어부터 실행을 재개

- 중단 : CPU가 실행 중인 프로그램을 강제로 중단시킬 수 밖에 없는 심각한 오류를 발견했을 때 발생하는 예외
- 소프트웨어 인터럽트 : 시스템 호출이 발생했을 때
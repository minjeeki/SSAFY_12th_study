# 연속 메모리 할당
## 스와핑(swapping)
- 메모리에서 사용되지 않는 일부 프로세스를 보조기억장치로 내보내고 실행할 프로세스를 메모리로 들여보내는 메모리 관리 기법
- `스왑 영역(swap space)` : 프로세스들이 쫒겨나는 보조기억장치의 일부 영역
- `스왑 아욱(swap-out)` : 현재 실행되지 않는 프로세스가 메모리에서 스왑 영역으로 옮겨지는 것
- `스왑 인(swap-in)` : 스왑 영역에 있던 프로세스가 다시 메모리로 옮겨오는 것
## 메모리 할당
- `최초 적합(first fit)` : 최초로 발견한 적재 가능한 빈 공간에 프로세스를 배치하는 방식
- `최적 적합(best fit)` : 프로세스가 적재될 수 있는 가장 작은 공간에 프로세스를 배치하는 방식
- `최악 적합(worst fit)` : 프로세스가 적재될 수 있는 가장 큰 공간에 프로세스를 배치하는 방식
## 외부 단편화
- `외부 단편화(external fragmentation)` : 프로세스를 할당하기 어려울 만큼 작은 메모리 공간들로 인해 메모리가 낭비되는 현상을 의미
- 메모리 압축(메모리 조각 모음) : 흩어져 있는 빈 공간들을 하나로 모으는 방식으로 메모리 내에 저장된 프로세스를 적당히 재배치시켜 여기저기 흩어져 있는 작은 빈 공간들을 하나의 큰 빈 공간으로 만드는 방법
  - 단점
    - 많은 오버헤드 야기
    - 현재는 가상 메모리 기법, 특히 페이징 기법으로 사용하는 중
# 페이징을 통한 가상 메모리 관리
- `가상 메모리(virtual memory)` : 실행하고자 하는 프로그램을 일부만 메모리에 적재하여 실제 물리 메모리 크기보다 더 큰 프로세스를 실행할 수 있게 하는 기술
## 페이징
- 기본적인 아이디어 : **프로세스를 연속적으로 할당하지 말고, 일정한 단위로 잘라서 불연속적으로 할당 안되나?**
- `페이징(paging) ` : 메모리 물리 주소 공간을 `프레임` 단위로 자르고, 프로세스의 논리 주소 공간을 `페이지` 단위로 자른 뒤 각 페이지를 프레임에 할당
- 실행에 필요한 페이지들만 swap in(`page in`), 나머지는 보조기억장치로 swap out(`page out`)
## 페이지 테이블
- 메인 메모리에 적재되어 있는 **페이지 번호**와 해당 페이지가 위치한 메인 메모리의 **시작 주소**가 있음
- 프로세스를 나눈 가상 메모리 페이지들이 각각 실제 메인 메모리의 어디 프레임에 적재되어 있는지 알아낼 수 있음
  > 내부 단편화 : 페이지 크기가 10KB인데, 프로세스 크기가 108KB라면 2KB 만큼의 크기가 남음
- `페이지 테이블 베이스 레지스터(Page Table Base Register, PTBR)` : 각 프로세스의 페이지 테이블이 적재된 주소를 가짐
  - 문제점 : CPU에서 메모리 접근시 (1)페이지 테이블 접근 (2)해당하는 프레임 접근 총 두 번 메모리 접근 필요
  - CPU 곁, 주로 `MMU(Memory Management Unit)` 에 `TLB(Translation Lookaside Buffer)`라는 페이지 테이블의 캐시를 둠
  - 해당 되는 주소가 있으면 (`TLB hit`) 물리주소가 리턴되고 메모리에 접근
  - TLB에서 해당되는 주소가 없을 경우 (`TLB miss`) 페이지테이블에서 맵핑이 존재하는지 찾음
    - 존재할 경우에 (`page table hit`) 이 값은 다시 TLB에 쓰고 물리 주소로 변환 후, 메모리에 접근
    - 페이지 테이블에서도 못찾으면 disk에서 찾고 페이지 테이블, TLB에 쓰고 물리주소로 변환 후 메모리에 접근
- https://en.wikipedia.org/wiki/Page_table
  ![image](https://github.com/user-attachments/assets/9d8e312a-b3ad-4255-aebe-299a4c03ec4f)
## 페이징에서의 주소 변환
- 어떤 페이지 또는 페르엠에 접근하고 싶은지 - `페이지 번호(page number)`
- 접근하려는 주소가 그 페이지 혹은 프레임으로부터 얼마나 떨여져 있는지 - `변위(offset)`
## 페이지 테이블 엔트리
- `페이지 테이블 엔트리(Page Table Entry, PTE)` : 페이지 테이블의 각각의 행들
- `유효 비트(valid bit)` : 현재 해당 페이지에 접근 가능한지 여부 알려줌 (메모리 적재시 1, 아니면 0)
  - 유효 비트 0인 페이지 접근 시 `페이지 폴트(page fault)` 발생
- `보호 비트(protection bit)` : 페이지 보호 기능을 위해 존재하는 비트 (불가능 0, 가능 1)
  - `r`, `w`, `x` : 각각 읽기, 쓰기, 실행 권한
- `참조 비트(reference bit)` : CPU 접근 여부
- `수정 비트(modified bit)` : 데이터를 쓴적 있는지 여부, 더티 비트(dirty bit)
  - 페이지가 메모리에서 사라질 때 보조기억장치에 쓰기 작업 해야되는 여부 판단 기준
- 페이징의 이점으로 쓰기 시 복사(copy on write)가 있음
- 페이지 테이블을 페이징하여 여러 단계의 페이지 테이블을 두는 방식
# 페이지 교체와 프레임 할당

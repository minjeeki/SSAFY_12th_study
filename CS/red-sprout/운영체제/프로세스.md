# 프로세스
## 프로세스 개요
### 프로세스 직접 확인하기
- 프로세스 : 실행 중인 프로그램
- 포그라운드 프로세스(foreground process) : 사용자 앞에서 실행되는 프로세스
- 백그라운드 프로세스(background process) : 사용자가 보지 못하는 뒤편에서 실행되는 프로세스
  - 데몬(유닉스, daemon) || 서비스(윈도우, service) :사용자와 상호작용하지 않고 정해진 일만 수행하는 백그라운드 프로세스
### 프로세스 제어 블록
- 프로세스 제어 블록(Process Control Block, PCB || Task Control Block, TCB) : 프로세스와 관련된 정보를 저장하는 자료구조
#### PCD에 담긴 정보들
- 프로세스 ID(Process ID, PID) : 특정 프로세스를 식별하기 위해 부여하는 고유한 번호
- 레지스터 값 : 프로세스는 자신의 실행 차례가 돌아오면 이전까지 사용했던 레지스터의 중간값들을 모두 복원
- 프로세스 상태 : 현재의 프로세스가 어떤 상태인지 기록
- CPU 스케줄링 정보 : 프로세스가 언제, 어떤 순서로 CPU를 할당 받을지
- 메모리 관리 정보 : 프로세스마다 메모리에 저장된 위치가 다름, 페이지 테이블 정보 역시 PCB에 담김
- 사용한 파일과 입출력장치 목록
### 문맥 교환
- 인터럽트 발생시
  - 시스템은 실행되는 프로세스의 현재 context를 저장
  - 수행 재개하려면 context를 복원할 필요가 있음
- 문맥(context) : 하나의 프로세스 수행을 재개하기 위해 기억해야 할 정보, PCB에 기록되는 정보
- 문맥 교환(context switching) : 기존 프로세스의 문맥을 PCB에 백업하고 새로운 프로세스를 실행하기 위해 문맥을 PCB로부터 복구하여 새로운 프로세스를 실행하는 것
  - 또다른 프로세스로 CPU core를 변경
  - 현재 프로세스 상태 저장
  - 다른 프로세스의 상태 복원
  - 너무 잦은 context switching은 오버헤드 발생으로 좋지 않음
 ### 프로세스의 메모리 영역
- 코드 영역(code segment, text segment) : 실행할 수 있는 코드, 즉 기계어로 이루어진 명령어가 저장됨
- 데이터 영역(data segment) : 잠깐 썼다가 없앨 데이터가 아닌 프로그램이 실행되는 동안 유지할 데이터가 저장, **전역 변수**, 정적 할당 영역
- 힙 영역(heap segment) : 프로그래머가 직접 할당할 수 있는 저장공간
  - 힙 영역에 메모리 공간을 할당했다면 해당 공간은 반환
  - 반환하지 않는다면 메모리 낭비 - **메모리 누수(memory leak)**
- 스택 영역(stack segment) : 데이터를 일시적으로 저장하는 공간
  - 매개 변수, 지역변수
- 힙 & 스택 영역 : 동적 할당 영역(실시간으로 그 크기가 변할 수 있음)
## 프로세스 상태와 계층 구조
### 프로세스 상태
- 기본적으로 프로세스가 실행되면 그 상태가 바뀜
- 생성 상태(new) : 프로세스를 생성중인 상태
- 준비 상태(ready) : 당장이라도 CPU를 할당받아 실행할 수 있지만, 아직 자신의 차례가 아니기에 기다리고 있는 상태
  - 차례가 되면 CPU를 할당 받아 실행 상태가 됨
  - 디스패치(dispatch) : 준비 상태인 프로세스가 실행상태로 전환되는 것
- 실행 상태(running) : CPU를 할당받아 실행 중인 상태
- 대기 상태(blocked, waiting) : 어떤 이벤트가 실행되기 위해 기다리는 상태
  - 입출력의 경우 입출력장치가 입출력을 끝낼 때까지(입출력 완료 인터럽트를 받을 때까지) 기다려야 함
- 종료 상태(terminated) : 프로세스가 종료된 상태
- 프로세스 상태 다이어그램(process state diagram)
  
  ![image](https://github.com/user-attachments/assets/44215307-0085-4171-abea-be8574139e6c)

### 프로세스 계층 구조
- 프로세스는 System call을 통해 다른 프로세스 생성 가능
  - 새 프로세스를 생성한 프로세스 : 부모 프로세스(parent process)
  - 부모 프로세스에 의해 생성된 프로세스 : 자식 프로세스(child process)
  - 서로 각기 다른 PID, 일부 OS에서는 PPID(Parent PID)를 가지기도 함
- 자바의 object 처럼 제일 위에 있는 최초의 프로세스는 뭘까? 명령어 `pstree`(프로세스 계층 구조)를 통해 확인하면...
  - 유닉스 : `init`
  - 리눅스 : `systemd`
  - macOS : `launchd`
  
  ![image](https://github.com/user-attachments/assets/52c1d069-c6b5-4a3f-8dd5-20e0e869d13d)

### 프로세스 생성 기법
- 부모 프로세스는 `fork`를 통해서 자신의 복사본을 자식 프로세스로 생성
- 자식 프로세스는 `exec`를 통해서 자신의 메모리 공간을 다른 프로그램으로 교체
- https://github.com/kangtegong/self-learning-cs/blob/main/process/process_cplusplus.md

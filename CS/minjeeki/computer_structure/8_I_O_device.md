# 8. 입출력 장치

- 목차

# 입출력 장치와 컴퓨터의 연결 통로

> 입출력 장치와 컴퓨터의 연결 통로
> 
> - 장치 컨트롤러 : 하드웨어적 통로
> - 장치 드라이버 : 소프트웨어적 통로

## 장치 컨트롤러 (device controller)

(= 입출력 제어기 I/O controller, 입출력 모듈 I/O module)

: 컴퓨터와 입출력 장치를 연결하는 하드웨어적 통로

<aside>
💡 입출력장치와 컴퓨터(CPU, 메모리)를 직접적으로 연결하지 않는 이유

- 입출력장치 너무 다양 ⇒ 입출력장치와 정보를 주고 받는 방식을 규격화하기 어려움
- 입출력 장치와 컴퓨터의 데이터 전송률 차이가 큼 ⇒ 직접적 통신 어려움
    
    > 전송률 (transfer rate) : 데이터를 얼마나 빨리 교환할 수 있는가에 대한 지표
    > 
</aside>

### 장치 컨트롤러의 역할

- CPU와 입출력장치 간의 통신 중개
- 오류 검출
    
    : 컴퓨터와 입출력 장치 사이에서 번역가 역할을 하며 입출력 장치의 문제를 검출
    
- 데이터 버퍼링 (buffering)
    
    : 전송률이 높은 CPU와 전송률이 낮은 입출력장치와의 전송률 차이를 완화하기 위한 방법
    
    > 버퍼링 : 버퍼에 데이터를 조금씩 모았다가 한꺼번에 내보내거나 데이터를 한번에 많이 받아 조금씩 내보는 방법
    > 
    > 
    > (전송률이 높은 장치와 낮은 장치 사이에 주고 받는 데이터를 버퍼라는 임시 저장 공간에 저장해 전송률을 비슷하게 맞추는 방법)
    > 

### 장치 컨트롤러 내부 구조

> 주요 장치 : 데이터 레지스터, 상태 레지스터, 제어 레지스터
(상태 레지스터와 제어 레지스터는 상태/제어 레지스터로 사용되기도 한다)
> 
- 데이터 레지스터 (data register)
    
    : CPU와 입출력 장치 사이 주고 받을 데이터가 담기는 레지스터 ⇒ 버퍼 역할
    
    > 최근 주고 받는 데이터가 많은 입출력 장치에서는 레지스터 대신 RAM을 사용하기도 함
    > 
- 상태 레지스터 (status register)
    
    : 입출력 장치의 상태 (작업 준비 완료, 작업 완료, 오류 여부 등)가 저장되는 레지스터
    
- 제어 레지스터 (control register)
    
    : 입출력 장치가 수행할 내용에 대한 제어 정보와 명령을 저장
    

## 장치 드라이버 (device driver)

: 장치 컨트롤러의 동작을 감지하고 제어하는 소프트웨어 프로그램
(장치 컨트롤러가 컴퓨터 내부와 정보를 주고 받을 수 있게 하는 프로그램)

- 장치 드라이버 인식 가능, 실행 가능 : 컴퓨터 내부와 정보 주고받기 가능
    
    장치 드라이버 인식 불가, 실행 불가 : 컴퓨터 내부와 정보 주고받기 불가
    
- 장치 드라이버의 인식, 실행 주체 : 운영체제
(장치 제작자가 드라이버를 따로 제공하는 경우 설치해야 사용 가능)

# 다양한 입출력 방법

> CPU와 장치 컨트롤러가 정보를 주고받는 방법
> 
> - CPU가 모든 입출력에 관여
>     - 프로그램 입출력
>     : 즉각적인 입출력 작업 (메모리 맵 입출력 / 고립형 입출력)
>     - 인터럽트 기반 입출력 (장치 컨트롤러에 의해 발생하는 입출력 방식)
>     : 비동기적인 입출력 작업
> - CPU를 거치지 않고도 상호작용 가능
>     - DMA 입출력
>     : DMA 컨트롤러 대행 비동기적 입출력 작업

## 프로그램 입출력 (Programmed I/O)

: 프로그램 속 명령어로 입출력 장치를 제어하는 방법

⇒ CPU가 프로그램 속 명령어를 실행하는 과정에서 입출력 명령어를 만나면 장치 컨트롤러와 상호작용 진행

### 프로그램 입출력 기반 입출력 작업 과정

> CPU가 장치 컨트롤러의 레지스터 값을 읽고 쓰면서 작업 진행
> 
1. CPU가 프로그램 내 명령어 중 입출력 명령어를 만남
CPU가 장치 드라이버의 인식 및 실행 가능 여부를 확인
2. CPU가 장치 컨트롤러의 제어 레지스터에 입/출력 명령어를 저장
3. 장치 컨트롤러가 입출력 장치의 상태를 장치 컨트롤러 내 제어 레지스터에 저장
CPU가 제어 레지스터의 상태를 주기적으로 확인하며 입출력 장치의 작업 가능 여부 확인
    
    > 폴링 : 주기적으로 입출력 장치의 상태와 처리 데이터 여부를 확인하는 방식
    (인터럽트 방식에 비해 CPU 부담이 더 큰 편)
    > 
4. 제어 레지스터에 저장된 상태가 입출력 장치 준비 완료의 경우 작업할 내용을 데이터 레지스터에 저장

---

### 프로그램 입출력 기반 입출력 작업에서
CPU가 장치 컨트롤러 속 레지스터 주소를 알아내는 방법

> 메모리 접근 주소 공간과 장치 컨트롤러 내 레지스터 접근 주소 공간을 하나로 간주하는가 아닌가에 따라 방식이 나뉨
> 
1. 메모리 맵 출력 (memory-mapped I/O)
    
    : 메모리에 접근하기 위한 주소 공간과 입출력 장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 방법
    
    ⇒ 메모리의 주소나 장치 컨트롤러의 레지스터나 상관없이 모두 똑같이 메모리 주소 대하듯 다룸 (같은 주소 공간 이용)
    
    - 특징
        - 메모리 접근 명령어와 입출력장치 접근 명령어를 다르게 할 필요가 없음
        - 메모리 주소 공간이 축소됨
2. 고립형 입출력 (isolated I/O)
    
    : 메모리를 위한 주소 공간과 입출력 장치를 위한 주소 공간을 분리하는 방법
    
    - 특징
        - 메모리 접근 명령어와 입출력 장치 접근 명령어가 다름
        (입출력 장치 접근 전용 명령어 사용)
        - 메모리 주소 공간이 축소되지 않음

## 인터럽트 기반 입출력 (Interrupt-Driven I/O)

: CPU가 장치 컨트롤러에 입출력 작업을 명령어하고 장치 컨트롤러가 입출력 장치를 제어하며 입출력을 수행하는 동안 CPU는 다른 일 수행 가능

### 인터럽트 기반 입출력 작업 과정

1. CPU의 입출력 관련 명령어를 장치 컨트롤러에 전달
2. 장치 컨트롤러가 입출력 장치를 제어하며 입출력 수행 (CPU는 다른 일 진행 가능)
3. 장치 컨트롤러가 입출력 과정을 끝낸 뒤 CPU에게 인터럽트 요청 신호 보냄
4. CPU는 하던 일을 잠시 백업한 뒤 인터럽트 서비스 루틴을 실행함

### 인터럽트 기반 입출력 다중 처리

> 인터럽트를 처리하는 도중 다른 인터럽트가 발생한 경우?
> 
> - 우선순위를 반영하여 다중 인터럽트 처리
> - PIC (Programmable Interrupt Controller) 하드웨어 사용
- 우선순위 반영해 다중 인터럽트 처리
    - if 인터럽트 비트 활성화:
        
        우선순위 높은 인터럽트부터 처리
        
    - else (인터럽트 비트 비활성화):
        
        if NMI (Non-Maskable Interrupt) 발생:
        
        우선순위 높은 인터럽트부터 처리
        
        else:
        
        현재 진행 중인 인터럽트 작업 계속
        
- 프로그래머블 인터럽트 컨트롤러(PIC) 하드웨어 사용
    
    : 여러 장치 컨트롤러에 연결되어 장치 컨트롤러에서 보낸 하드웨어 인터럽트 요청 우선순위 판별 후 CPU에 지금 처리해야 할 하드웨어 인터럽트가 뭔지 알려주는 장치
    
    - PIC의 각 핀에는 CPU에 하드웨어 인터럽트 요청을 보낼 수 있는 하드웨어 연결
    - 더 많고 복잡한 장치들의 인터럽트를 관리하기 위해 PIC 두개 이상 계층적으로 구성하기도 함
    - PIC가 무시할 수 없는 인터럽트인 NMI까지 우선순위를 판별하지 않음
    (NMI는 우선순위가 가장 높기 때문에 우선순위 판별이 불필요함)
    - 세부 과정
        1. PIC가 장치 컨트롤러에서 인터럽트 요청 신호를 받아들임
        2. PIC는 인터럽트 우선순위를 판단한 뒤 CPU에 처리해야 할 인터럽트 요청 신호를 보냄
        3. CPU는 PIC에 인터럽트 확인 신호를 보냄
        4. PIC는 데이터 버스를 통해 인터럽트 벡터를 보냄
        5. CPU는 인터럽트 벡터를 통해 인터럽트 요청 주체를 알게 되고 해당 장치의 인터럽트 서비스 루틴을 실행함

## DMA 입출력 (Direct Memory Access)

: 직접 메모리에 접근할 수 있는 입출력 기능 (입출력 장치와 메모리가 CPU를 거치지 않고 상호작용)

- DMA 컨트롤러(시스템 버스에 위치)가 필요함

### DMA 입출력이 필요한 이유

- 인터럽트 기반 입출력 처리와 프로그램 기반 입출력 처리 모두 CPU가 주도 & CPU를 거쳐 진행
- 만약, 입출력 처리가 메모리와 입출력장치 간의 작업(CPU는 필요 없음)이라면?
    - CPU의 연산 시간 낭비
    - 대용량 데이터 이동 시 CPU 부담 증가
- DMA 입출력 작업 시 장점
    - CPU의 작업 부담 완화 (CPU는 입출력의 시작과 끝만 관여)

### DMA 입출력 과정

1. CPU가 DMA 컨트롤러에 입출력 장치의 주소, 수행 연산 (읽기 or 쓰기), 메모리 주소 등의 정보를 이용해 입출력 작업 명령
2. DMA 컨트롤러가 CPU 대신 입출력 장치와 상호작용하며 입출력 작업 수행
(필요한 경우 메모리에 직접 접근해 정보를 읽거나 씀)
3. 입출력 작업이 끝나면 DMA 컨트롤러는 CPU에 인터럽트를 걸어 작업이 끝났음을 알림

### DMA 입출력 방식의 문제와 해결

- DMA 컨트롤러는 시스템 버스에 위치해 있다.
    
    CPU도 이용하는 시스템 버스는 공용 자원이기에 동시에 사용이 불가하다
    
    - 해결 1. CPU가 시스템 버스를 이용하지 않을 때 조금씩 이용한다
    - 해결 2. CPU가 일시적으로 시스템 버스를 이용하지 않도록 허락을 구한 뒤 집중적 이용
    (사이클 스틸링)
- DMA는 메모리 ↔ DMA, DMA ↔ 입출력 장치 상호작용에 시스템 버스를 사용한다.
    
    DMA가 시스템 버스를 자주 사용하면 CPU가 시스템 버스를 이용하지 못한다.
    
    - 해결. 입출력 버스(input/output bus)를 연결한다.
        
        장치 컨트롤러를 시스템 버스가 아닌 입출력 버스로 DMA 컨트롤러에 연결할 경우,
        DMA ↔ 입출력 장치의 소통 상황에서 시스템 버스를 이용하지 않아도 된다
        
        ⇒ 시스템 버스 사용 빈도 줄이기 가능
        

### DMA 참고 자료

- cf. 입출력 버스의 종류
    
    입출력 버스에는 PCI (Peripheral Component Interconnect) 버스, PCI Express(PCIe) 버스 등 여러 종류가 있다.
    
- 입출력 프로세서 (IOP: input/output processor)
    
    = 입출력 채널 (Input/Output Channel)
    
    : 메모리에 직접 접근할 뿐만 아니라 입출력 명령어를 직접 인출, 해석, 실행하는 입출력 전용 CPU
    
    1. CPU → 입출력 채널에 메모리에 저장된 특정 입출력 명령어 수행 지시
    2. 입출력 채널이 해당 입출력 명령어 인출, 해석, 실행
    3. 인출력 채널 → CPU에 인터럽트를 보내 결과 알림

## 문제

### 1. 입출력 장치가 컴퓨터(CPU, 메모리)에 직접적으로 연결되지 않는 이유에 대해서 설명하세요.

- chatGPT 답변
    
    입출력 장치가 컴퓨터(CPU, 메모리)에 직접적으로 연결되지 않는 이유는 **속도 차이**와 **복잡성**때문입니다.
    
    CPU와 메모리는 매우 빠르게 데이터를 처리할 수 있지만, 대부분의 입출력 장치는 상대적으로 속도가 느립니다. 이 속도 차이 때문에 입출력 장치가 CPU나 메모리와 직접 연결될 경우, 전체 시스템의 성능이 저하될 수 있습니다. 또한, 입출력 장치는 다양한 종류가 있으며, 각 장치마다 처리 방식과 인터페이스가 다르기 때문에 모든 장치를 직접 연결하려면 시스템이 복잡해지고 비효율적이 됩니다. 이를 해결하기 위해 입출력 제어기(I/O Controller)가 도입되어, 입출력 장치와 CPU 사이의 중재자 역할을 하게 됩니다.
    

### 2. 입출력 장치와 컴퓨터의 하드웨어적, 소프트웨어적 연결 방식에 대해서 설명하세요.

- chatGPT 답변
    
    입출력 장치와 컴퓨터 간의 하드웨어적 연결 방식은 **입출력 제어기(I/O Controller)**를 통해 이루어집니다. 입출력 제어기는 장치와 CPU 사이에서 데이터를 전송하고 제어하는 역할을 담당하며, 장치의 상태를 모니터링하고 데이터를 버퍼링합니다. 각 입출력 장치는 특정한 제어기와 연결되어 있으며, 제어기는 버스를 통해 CPU와 통신합니다.
    
    소프트웨어적 연결 방식은 **장치 드라이버(Device Driver)**를 통해 이루어집니다. 장치 드라이버는 운영체제의 일부로, 특정 입출력 장치를 제어하고 통신하는 소프트웨어입니다. 응용 프로그램은 직접 입출력 장치와 상호 작용하는 것이 아니라, 운영체제의 시스템 콜을 통해 간접적으로 장치 드라이버와 통신합니다. 장치 드라이버는 하드웨어의 세부 사항을 숨기고, 응용 프로그램이 입출력 장치를 쉽게 사용할 수 있도록 추상화된 인터페이스를 제공합니다.
    

### 3. DMA 입출력 방식에 대해서 설명하고, DMA 방식이 나오게 된 이유에 대해서도 설명하세요.

- chatGPT 답변
    
    **DMA(Direct Memory Access)** 입출력 방식은 CPU의 개입 없이 메모리와 입출력 장치 간에 직접 데이터를 전송할 수 있는 방법입니다. DMA 컨트롤러는 CPU가 아닌, 독립적인 하드웨어 장치로, 입출력 장치에서 메모리로 또는 메모리에서 입출력 장치로 데이터를 직접 전송할 수 있습니다.
    
    DMA 방식이 나오게 된 이유는 **CPU의 효율성**을 높이기 위해서입니다. 기존의 프로그램된 입출력 방식에서는 CPU가 입출력 장치와 메모리 간의 데이터 전송을 직접 관리해야 했습니다. 이로 인해 CPU는 입출력 작업을 기다리면서 다른 작업을 수행하지 못하고, 성능이 저하되는 문제가 발생했습니다. DMA를 사용하면 CPU는 입출력 작업을 DMA 컨트롤러에게 위임하고, 그동안 다른 작업을 수행할 수 있어 시스템의 전반적인 성능이 향상됩니다.
    
    DMA 방식은 특히 대용량 데이터를 전송할 때 유용하며, CPU의 부하를 줄이고 데이터 전송 속도를 높이는 데 중요한 역할을 합니다.
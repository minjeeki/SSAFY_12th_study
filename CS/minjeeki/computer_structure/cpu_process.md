# CPU 동작 원리

# CPU의 구조

![Untitled](CPU%20%E1%84%83%E1%85%A9%E1%86%BC%E1%84%8C%E1%85%A1%E1%86%A8%20%E1%84%8B%E1%85%AF%E1%86%AB%E1%84%85%E1%85%B5%20cdf2533e00f6406db9571c6bdbbc2eee/Untitled.png)

- 중앙처리장치 (Central Processing Unit)
- 메모리에서 저장된 명령어를 읽어들이고, 읽어들인 명령어를 해석 후 실행하는 부품
- CPU의 내부 구조와 역할
CPU는 기본적으로 3가지 모듈로 구성되며 내부 버스를 통해 서로 연결되어 있다.
    - ALU (산술/논리 장치) : 계산
    - 레지스터 : 실행에 필요한 값 (명령어, 데이터) 임시 저장
    - 제어장치 : 제어신호 전송 및 명령어 해석
- CPU가 명령어를 처리할 때는 일정한 주기가 존재하며, 그 주기를 끊는 요소도 있다.
    
    명령어 사이클 : CPU가 하나의 명령어를 처리하는데 정해진 일정한 흐름, 주기
    
    인터럽트 : CPU의 명령어 사이클을 중단하게 하는, 작업을 방해하는 신호
    

## 1. ALU (Arithemetic Logic Unit, 산술/논리 연산 장치)

- 컴퓨터 내부에 수행되는 계산, 연산(산술 연산 = + - * /, 논리 연산 = AND OR XOR)을 처리하는 CPU 내부 부품
- ALU에는 계산을 위한 여러 회로가 존재한다.
    
    가산기 (덧셈) / 보수기 (뺄셈) / 시프터 (스프트 연산) / 오버플로우 검출 (오버플로우)
    
- ALU가 받아들이는 정보
    - 데이터 (피연산자 / from 레지스터 ← 메모리)
    - 제어신호 (명령 / from 제어장치)
- ALU가 연산 수행 후 내보내는 정보
    - 연산 수행 결과 (문자, 숫자, 메모리 주소 등 / to 레지스터)
    - 플래그 (연산 추가 정보 / to 플래그 레지스터)
- 플래그의 종류
    - 부호 플래그 : 연산한 결과의 부호 나타냄 (1 = 음수 / 0 = 양수)
    - 제로 플래그 : 연산 결과가 0인지 여부 나타냄 (1 = 0 / 0 = 0이 아님)
    - 캐리 플래그 : 연산 결과가 올림수나 빌림수가 발생했는지 나타냄 (1 = 발생 / 0 = 발생 X)
    - 오버플로우 플래그 : 오버플로우의 발생 여부를 나타냄 (1 = 발생 / 0 = 발생 X)
        
        오버플로우 (overflow) : 연산 결과가 연산 결과를 담은 래지스터보다 큰 상황
        
    - 인터럽트 플래그 : 인터럽트 가능 여부를 나타냄 (1 = 가능 / 0 = 불가능)
    - 슈퍼바이저 플래그 : 커널 모드 / 사용자 모드 여부 나타냄 (1 = 커널 모드 / 0 = 사용자 모드)

## 2. 제어 장치 (Control Unit)

- CPU 내부와 외부에 제어 신호를 보내고, 명령어를 해석해 실행시키는 CPU 내부 부품
- 제어 신호
    
    컴퓨터 부품을 관리하고 작동시키기 위한 일종의 전기 신호
    
- 제어 장치가 받아들이는 정보
    - 클럭 신호 (clock, 부품의 작동 시간 단위)
        
        모든 부품을 움직일 수 있게 하는 시간 단위로, 모든 부품은 클럭 신호에 맞춰 작동한다.
        
    - 명령어 (현재 수행할 명령어 / from 명령어 레지스터 ← 메모리)
        
        ⇒ 제어 장치는 해석해야 할 명령어를 받아들여 해석한 뒤 제어 신호를 발생시켜 컴퓨터 부품들이 수행해야 할 내용을 알려준다.
        
    - 플래그값 (ALU 연산결과의 추가 상태 정보 / from 플래그 레지스터)
    - 제어 신호 (from 제어 버스)
        
        제어 신호는 CPU 뿐만 아니라 CPU 외부 장치에서도 발생시킬 수 있으며, 양방향 통로인 제어 버스를 통해 전달된다.
        
- 제어 장치가 내보내는 정보
    - CPU 외부에 전달하는 제어 신호 (by 제어 버스 in 시스템 버스)
        - to 메모리 : 메모리에 저장된 값 읽기(read) / 새로운 값 쓰기 (write)
        - to 입출력 장치 : 입출력 장치 값 읽기 / 새로운 값 쓰기
    - CPU 내부에 전달하는 제어 신호
        - to ALU : ALU에서 수행할 연산 지시
        - to 레지스터 : 레지스터 간 데이터 이동 / 명령 레지스터 내 저장된 명령어 해석

## 3. 레지스터 (Register)

- 프로그램 실행에 필요한 값(데이터, 명령어)을 메모리에서 가져와 임시 저장하는 CPU 내부 부품
CPU의 현재 상태(state)를 저장할 공간으로 사용되기도 함
- CPU에는 여러개의 레지스터가 존재하며, 각기 다른 이름과 역할을 갖고 있으며, 상용화된 레지스터들은 CPU마다 이름, 크기, 종류가 매우 다양하다.
- 프로그램 속 명령어와 데이터는 실행 전후로 반드시 레지스터에 저장되기 때문에
레지스터에 저장된 값만 잘 관찰해도 프로그램의 실행 흐름(과정, 순서)를 파악할 수 있다.

### 3-01. 특수 목적 레지스터

- 프로그램 카운터 / 명령어 포인터 (PC: Program Counter / IP : Instruction Pointer)
    
    메모리에서 가져올 명령어의 주소, 메모리에서 읽어 들일 명령어의 주소를 저장하는 레지스터
    
    프로그램 카운터의 값이 증가하면서 순차적으로 프로그램을 읽고 실행하게 된다.
    
- 메모리 주소 레지스터 (MAR : Memory Address Register)
    
    CPU가 읽어 들이고자 하는 메모리의 주소 값을 저장하는 레지스터
    
    프로그램 카운터 내 메모리 주소를 옮겨와 주소 버스를 통해서 주소 값을 이동한다.
    
- 메모리 버퍼 레지스터 / 메모리 데이터 레지스터 (MBR : Memory Buffer Register / MDR : Memory Data Register)
    
    메인 메모리에 쓰고 싶은 값(데이터), 메모리로부터 전달 받은 값을 저장하는 레지스터
    
- 명령어 레지스터 (IR : Instruction Register)
    
    메인 메모리에서 읽어 들인, 해석할 명령어를 저장하는 레지스터
    
    제어 장치는 명령어 레지스터 내 명령어 정보를 받아 해석해 제어 신호를 내보낸다.
    
- 누산기 (AC)
    
    연산 결과를 임시로 저장하는 레지스터
    
- 범용 레지스터 (general purpose register)
    
    다양하고 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터
    
    데이터와 주소 모두 저장 가능
    
- 그 외에도 주소 지정에 사용할 수 있는 특별한 레지스터 스택 포인터, 베이스 레지스터 등이 있다

# 프로그램 동작 과정

## 1. CPU 연산 처리 과정

- 컴퓨터는 기본적으로 읽고, 처리한 뒤, 저장하는 과정으로 이뤄진다.
READ → PROCESS → WRITE
- 각각의 과정에서 제어 장치는 명령어가 순서대로 실행될 수 있도록 각 장치를 제어한다.
1. 보조 기억 장치에 있는 프로그램이 메인 메모리에 적재
2. CPU가 메인 메모리로 올라간 프로그램의 코드 영역 명령어와 데이터를 읽어 처리
(CPU의 제어 장치가 레지스터에 있는 값을 계산하라고 산술논리연산장치 ALI에 명령)
3. CPU가 처리한 데이터 결과를 다시 메인 메모리에 저장
(CPU의 제어 장치가 레지스터에서 메모리로 계산된 값을 저장)
4. 메인 메모리는 처리 결과를 보조 기억 장치 또는 출력 장치로 보냄

## 2. 명령어 사이클

- CPU가 하나의 명령어를 처리하는데 정해진 (정형화된, 일정한) 흐름 (주기)
- 프로그램을 이루는 수많은 명령어는 일반적으로 인출 사이클&실행 사이클을 반복, 실행함
- 인출 사이클 (fetch cycle)
메모리에 있는 명령어를 CPU로 가지고 오는 단계
(프로그램 카운터에 메모리 주소가 저장된 후 MAR & MBR & IR & 제어장치 등이 관여)
- 실행 사이클 (execution cycle)
CPU로 가져온 명령어를 실행하는 단계
(제어장치가 명령어 레지스터에 담긴 값을 해석하고 제어 신호를 발생)
- 간접 사이클 (indirect cycle)
명령어를 실행하기 위해 메모리 접근이 추가적으로 필요한 단계

## 3. 구체적인 CPU 연산 처리 과정

**<인출 사이클, fetch cycle>**

1. 프로그램 카운터(PC)에 읽어 들일 프로그램 명령어 초기 주소 저장
2. 메모리 주소 레지스터 (MAR)에 읽고자 하는 주소 저장
3. CPU의 제어 장치가 ‘읽기’ 제어 신호(제어 버스)와 MAR에 저장되어 있던 주소(주소 버스)를 메모리에 보냄
4. 메인 메모리 내 해당 주소에 저장된 값(명령어, 데이터 / 데이터 버스)이 메모리 버퍼 레지스터 (MBR)에 저장
5. 프로그램 카운터 (PC)의 값이 증가되어 다음 프로그램 명령어 읽을 준비 마침

**<실행 사이클, execution cycle>**

1. 메모리 버퍼 레지스터 (MBR)에 저장되어 있던 명령어가 명령어 레지스터로 이동
2. 제어 장치가 명령 레지스터에 있는 명령어를 읽고 해석해 제어 신호 발생, ALI에 전달

## 4. 인터럽트

: CPU의 작업을 방해하는 신호

> 인터럽트 발생 케이스
> 
> - CPU가 주목해야 할 때
> - CPU가 얼른 처리해야 할 작업이 생겼을 때
- 인터럽트 종류
    - 동기 인터럽트(= 예외)
    :  (by CPU)명령어들을 수행하다가 예상치 못한 상황에 마주쳤을 때
        
        ex. 프로그래밍 상의 오류
        
        - 폴트 : 예외 처리 직후 예외가 발생한 명령어부터 실행 재개
        - 트랩 : 예외 처리 직후 예외 발생 명령어 다음부터 실행 재개
        (주로 디버깅할 때 사용)
        - 중단 : CPU가 실행 중인 프로그램을 강제로 중단
        (심각한 오류를 발견했을 경우 사용)
        - 소프트웨어 인터럽트 : 시스템 호출 발생 시 진행
    - 비동기 인터럽트 (=하드웨어 인터럽트)
        
        : (by 입출력 장치) CPU가 일전에 명령을 요청한 다른 장치에서의 작업이 완료됐을 때
        
        - CPU가 주기적으로 다른 장치에서의 작업 완료 여부를 확인할 필요가 없음
        - 인터럽트 요청 신호 : 다른 장치에서 보낸 인터럽트 가능 여부 확인 메시지
        - 인터럽트 플래그 : 현재 CPU가 인터럽트를 받아들일 수 있는 상태인지 확인
        (플래그 레지스터의 인터럽트 플래그가 활성화되어 있어야 CPU가 요청 수용 가능)
- 인터럽트 서비스 루틴 (=인터럽트 핸들러) : 인터럽트를 처리하기 위한 프로그램
- 인터럽트 벡터 : 인터럽트 서비스 루틴을 식별하기 위한 정보
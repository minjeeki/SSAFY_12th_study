# 파일 시스템

# 파일과 디렉터리

## 파일

: 보조기억장치에 저장된 관련 정보의 집합 (의미 있고 관련 있는 정보, 데이터를 모은 논리적 단위)

### 파일 구성 정보

- 파일 이름
- 파일을 실행하기 위한 정보
- 파일 관련 부가 정보 (= 속성, 메타데이터)

### 파일의 특징

- 모든 파일은 경로와 이름이 존재한다
- 다른 경로에는 같은 이름의 파일이 있을 수 있다
(경로와 파일 이름이 모두 같을 수는 없다)
- 하나의 파일에는 데이터가 들어있다

### 변수와 파일의 차이

- 변수
    - 메모리에 존재
    - 일시적으로 데이터를 메모리에 올려놓고 작업을 할 때 사용
- 파일
    - 디스크에 존재
    - 영구적으로 데이터를 저장해서 사용할 때 파일에 담아서 사용

### 파일의 종류

- 일반 파일 : 실제 데이터를 저장하는 파일
- 디렉터리 : 파일들을 그룹화하여 관리하는 컨테이너 역할을 하는 파일
- 심볼릭 링크 파일 : 어떤 다른 파일, 디렉토리의 경로를 참조하는 파일
    - 심볼릭 링크 자체는 데이터가 없고 단순히 참조하는 파일의 위치 정보를 가리킨다
    
    [(리눅스) 아이노드, 하드 링크와 소프트 링크](https://www.notion.so/7e272fb76ade48e4a7651e17c857a0c8?pvs=21)
    
- 디바이스 파일 : 하드웨어 장치와 상호작용하기 위해 존재하는 특수 파일
    - 블록 디바이스 파일 : 블록 디바이스(디스크 같은 대용량 저장 장치)를 제어하기 위한 파일
    - 문자 디바이스 파일 : 문자 디바이스(키보드, 마우스 등의 장치, 데이터)를 제어하기 위한 파일
    - 윈도우의 경우 디바이스 파일에 대한 명시적인 파일 관리 시스템은 없지만 장치 드라이버를 통해 하드웨어와 상호작용함
- 파이프 파일 (Named Pipe) : 파이프를 나타내는 파일 / 프로세스 간 통신 (IPC)에 사용
- 소켓 파일 : 소켓을 나타내는 파일
    - 네트워크 통신을 위해 (네트워크 상에서 프로세스가 데이터를 주고받기 위해) 사용
    - 윈도우도 소켓을 지원하나 소켓 파일 자체는 윈도우 파일 시스템에서는 볼 수 없음

## 파일 속성의 종류

> 운영체제, 특히 파일 시스템은 파일별로 속성을 유지하고 관리한다
> 
- 유형 : 운영체제가 인식하는 파일의 종류
    - 파일의 유형에 따라 실행 양상도 달라진다
    - 확장자(extension) : 파일 이름의 일부로 파일 이름 뒤에 .을 붙여서 나타낸 메타 데이터
        - 파일 유형, 용도를 알리기 위해 가장 흔히 사용하는 방식
        - 운영체제나 프로그램은 확장자를 통해 파일을 어떻게 처리할지 결정하는 경우가 많음
        
        [“리눅스/유닉스 계열 운영체제에서는 파일의 확장자가 꼭 필요하지 않다”](https://www.notion.so/8d557f6949d44c7e90cde5582b63a4a2?pvs=21)
        
        - 유형별 대표 확장자
            - 실행 파일 : exe, com, bin, (없음)
            - 목적 파일 : obj, o
            - 라이브러리 파일 : lib, a, so, dll
            - 백업/보관 파일 : rar, zip, tar
- 크기 : 파일의 현재 크기와 허용 가능한 최대 크기
- 보호 : 파일 읽기(r), 쓰기(w), 실행(x)에 대한 사용자별 권한 여부
- 생성 날짜 : 파일이 생성된 날짜
- 마지막 접근 날짜 : 파일에 마지막으로 접근한 날짜
- 마지막 수정 날짜 : 파일이 마지막으로 수정된 날짜
- 생성자 : 파일을 생성한 사용자
- 소유자 : 파일을 소유한 사용자
- 위치 : 보조기억장치 상의 파일의 현재 위치

### 파일 연산을 위한 시스템 호출

[시스템 호출](https://www.notion.so/4eaf033d48b54bc48f6e0f283615115b?pvs=21)

> 파일을 다루는 모든 작업은 운영체제에 의해 이루어지며, 파일을 다루기 위해서는 시스템 호출을 통해 운영체제에 부탁해야 한다.
> 
- 파일 생성
- 파일 삭제
- 파일 열기
- 파일 닫기
- 파일 읽기
- 파일 쓰기

## 디렉터리

: 파일을 일목요연하게 관리하기 위한 도구

- 윈도우 운영체제에서는 디렉터리는 폴더라고 함

### 디렉터리 구조

- 1단계 디렉터리 (single level directory)
    
    : 모든 파일이 하나의 디렉터리 안에 있는 구조
    
    - 많은 파일 관리에는 한계가 있기 때문에 트리 구조 디렉터리가 생김
- 트리 구조 디렉터리 (tree structured directory)
    
    : 최상위 디렉터리 아래 서브 디렉터리(자식 디렉터리)가 있을 수 있는 구조
    
    - 루트 디렉터리 : 최상위 디렉터리를 지칭
        - `/` 와 같이 표현
        - 윈도우 운영체제에서는 `C:\`로 표현
        
        ---
        
        - 경로 구분자 표현
            - 유닉스, 맥, 리눅스 : `/`
            (루트 디렉터리를 표현할 때는 `/home/minjee/a.sh`와 같이 표현
            - 윈도우 : `\`
    - 경로 : 디렉터리를 이용해 파일 위치, 파일 이름을 특정 짓는 정보
        - 상대 경로와 절대 경로의 두가지 방식으로 표현 가능
        
        ---
        
        - 절대 경로 (absolute path)
            
            : 루트 디렉터리에서 자기 자신까지 이르는 고유한 경로
            
            - 모든 파일에는 고유한 절대 경로가 있다
        - 상대 경로 (relative path)
            
            : 현재 디렉터리부터 시작하는 경로
            
            - 현재 디렉터리 표현 : `.`
            - 상위 디렉터리 표현 : `..`
            (루트 디렉터리에서는 `cd ..`을 입력해도 현재 작업 디렉터리는 변하지 않음)

### 디렉터리 연산을 위한 시스템 호출

- 디렉터리 생성
- 디렉터리 삭제
- 디렉터리 열기
- 디렉터리 닫기
- 디렉터리 읽기

### “디렉터리는 특별한 형태의 파일이다 (별개의 존재가 아니다)”

- 파일에 담긴 정보 : 파일과 관련된 정보
    
    디렉터리에 담긴 정보 : 디렉터리에 담겨 있는 대상과 관련된 정보
    
- 디렉터리는 보조기억장치에 테이블 형태의 정보로 저장된다 ⇒ `디렉터리 엔트리`
    - 테이블의 행(엔트리)에 담긴 정보는 파일 시스템마다 차이가 있다
    - 디렉터리 엔트리를 통해 파일(정보), 해당 정보의 보조기억장치 상 위치를 유추할 수 있다
    - 파일 시스템에 따라 디렉터리 엔트리에 파일 속성을 명시하는 경우도 있다

# 파일 시스템

: 운영체제가 데이터를 저장하고 조직하며, 관리하는 방법을 정의하는 구조이자 메커니즘

### 파일 시스템의 주요 기능

- 데이터 저장 및 관리 :
    
    데이터를 디스크에 저장하고, 위치를 추적하며 필요할 경우 읽거나 쓰기 (수정) 작업을 함
    
    ⇒ 파일 할당
    
- 디렉터리 관리 :
    
    파일들을 디렉터리 안에 정리할 수 있도록 지원하며, 사용자와 프로그램이 계층적으로 파일을 관리할 수 있도록 도움
    
- 파일 권한 및 보안 관리
    
    : 파일/디렉터리 마다 권한을 설정해 파일에 대한 접근 제어(rwx 권한)
    
- 데이터의 무결성 및 복구
    
    : 데이터가 손상되거나 디스크 장애가 발생할 경우 데이터를 보호하기 위한 기능 (저널링, 스냅샷)을 제공 ⇒ 데이터의 손실을 방지하거나 최소화
    
    [저널링과 스냅샷](https://www.notion.so/60d7265258dd4bf390c54e6509ece5e5?pvs=21)
    

## 보조기억장치 사용하기 : 파티셔닝과 포매팅

### 파티셔닝 (partitioning)

: 저장 장치의 논리적인 영역을 구획하는 작업 (용량이 큰 저장 장치를 하나 이상의 논리적 단위로 구획하는 것)

- 파티션 : 파티셔닝 작업을 통해 나누어진 영역 단위
(하나의 물리적 저장 장치를 논리적으로 나눈, 독립된 여러 구역)
    - 각 파티션은 독립된 드라이브처럼 운영체제에서 인식됨 서로 다른 운영체제를 설치하거나 데이터를 분리해서 저장할 수 있다
    
    [파티션](https://www.notion.so/cf1ad7b9985c4d7eb5ae7c6c394f64d9?pvs=21)
    

### 포매팅 (formatting)

: 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지를 결정하고 새로운 데이터를 쓸 준비를 하는 작업

⇒ 포매팅 단계에서 어떤 종류의 파일 시스템을 사용할 것인지 결정

- 저수준 포매팅과 논리적 포매팅
    - 저수준 포매팅 : 물리적 포매팅
    - 논리적 포매팅 : 파일 시스템 생성

## 파일 할당

### 운영체제는 파일과 디렉터리를 블록 단위로 읽고 쓴다

(= 하나의 파일이 보조기억장치에 저장될 때는 하나 이상의 블록에 걸쳐 저장된다)

- 하드 디스크의 가장 작은 저장 단위는 섹터
    
    파일 시스템이 모든 섹터를 관리하기에는 개수가 많고 크기가 작아 섹터를 블록으로 묶은 뒤 블록 단위로 관리함
    
- 윈도우에서는 블록이라는 용어 대신 클러스터라는 용어를 사용한다

### 파일 할당 방법에는 크게 두가지가 있다

> 파일 할당 방법에는 두가지가 있으며, 오늘날까지 사용되는 방식은 불연속 할당이다
> 
1. 연속 할당
2. 불연속 할당
    - 연결 할당
    - 색인 할당

### 연속 할당 (contiguous allocation)

: 보조기억장치 내 연속적인 블록에 파일을 할당하는 방식

- 연속으로 할당된 파일에 접근하기 위해서는 파일의 첫번째 블록 주소와 블록 단위의 길이만 알면 된다
    
    ⇒ 연속 할당을 사용하는 파일 시스템의 디렉터리 엔트리에는 ‘파일 이름‘, ’첫번째 블록 주소’, ‘블록 단위의 길이’를 명시한다
    
- 가장 단순한 방식 ⇒ 구현이 쉬움
- 발생하는 문제점
    - 외부 단편화 :
        
        (파일의 블록 개수가 현재 보조기억장치에 존재하는 연속된 블록 최대 개수보다 작을 경우 파일 할당이 불가함)
        

### 불연속 할당 > 연결 할당 (linked allocation)

: 각 블록 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당하는 방식

- 하나의 블록 안에 파일 데이터와 다음 블록 주소가 포함되어 있는 형태
- 파일을 이루는 데이터를 연결 리스트로 관리

---

- 외부 단편화 해결 가능
- 단점
    - 첫번째 블록부터 하나씩 차례대로 읽어야 함
    (파일의 중간 부분부터 접근하고 싶어도 파일의 첫번째 블록부터 접근해 하나씩 차례로 읽어야 함)
        
        ⇒ 파일 임의 접근 (파일 내 임의의 위치에 접근) 속도가 매우 느림
        
    - 하드웨어 고장이나 오류 발생 시 해당 블록 이후 블록은 접근 불가함
        
        ⇒ 그대로 구현하기 보다는 조금 변형해서 사용하는 편 (FAT 파일 시스템)
        

### 불연속 할당 > 색인 할당 (indexed allocation)

: 모든 블록 주소를 색인 블록 (index block)이라는 하나의 블록에 모아 관리하는 방식

- 파일에 접근하고 싶다면 해당 파일의 색인 블록에 저장된 주소에 접근
    
    ⇒ 파일 내 임의 위치에 접근할 수 있음
    
- 디렉터리 엔트리에는 파일 이름과 더불어 색인 블록 주소를 명시함
- 색인 할당을 기반으로 만든 파일 시스템 : 유닉스 파일 시스템

## 파일 할당 방식의 구현 - FAT 파일 시스템, 유닉스 파일 시스템

> FAT 파일 시스템, 유닉스 파일 시스템 외에도 다양한 운영체제가 존재한다
> 
> - NTFS : 윈도우 운영체제의 NT 파일 시스템
> - ext 파일 시스템 : 리눅스 운영체제에서 사용되는 파일 시스템

### FAT 파일 시스템

- 불연속 파일 할당 > 연결 할당을 변형한 방식
- 블록에 포함된 다음 블록의 주소들을 한데 모아 테이블의 형태로 관리해서 연결 할당의 문제(임의 접근, 블록 하나 문제 발생 시 이후 블록 탐색 불가)를 해결
    
    ⇒ 파일 할당 테이블 (File Allocation Table)
    
- 이용 : 과거 MS 운영체제인 MS-DOS에서 사용 / 저용량 저장 장치(USB, SD)용 파일시스템으로 이용
- 블록(클러스터)를 표현하는 비트 수에 따라 버전을 구분해 FAT12, FAT16, FAT32가 존재함

### FAT 파일 시스템을 채택한 파티션 영역 구분

> 하나의 파티션에 예약 영역, FAT 영역, 루트 디렉터리 영역, 데이터 영역이 순차적으로 존재
(핵심은 FAT 테이블을 통해 파일이 어떤 클러스터에 저장되어 있는지 추적하는 것)
> 
- 예약 영역 (Reserved Area
    
    : 부트 섹터를 포함한 예약된 공간으로 보조 부트 섹터 또는 다른 운영체제의 부팅 정보가 들어감
    
    - 부트 섹터
        
        : 디스크의 첫번째 섹터에 위치하며 파일 시스템의 구조와 파티션 기본 정보를 저장
        
        - 부트 코드 : 운영체제를 부팅하기 위한 코드, 시스템 부팅시 실행됨
        - BPB (BIOS Parameter Block) : 디스크 및 파일 시스템 특성에 대한 정보를 담고 있음
        (섹터 크기, 블록 크기, FAT 테이블 위치 및 크기, 루트 디렉터리 위치 등)
        - 파일 시스템 유형 : FAT12, FAT16, FAT32 등
- FAT 영역 (FAT 테이블)
    
    : 파일의 데이터가 저장된 블록(클러스터)들을 추적하는 테이블
    
    - 각 블록에 연결된 다음 블록을 기록하며, FAT 파일 시스템의 핵심적인 역할을 함
    - 파티션의 시작 부분에 있으나 실행 도중 FAT가 메모리에 캐시될 수도 있음
    (기존 연결 할당보다 다음 블록 찾는 속도가 빨라지며 임의 접근 성능이 개선됨)
- 루트 디렉터리 영역
    
    : 최상위 디렉터리 (파일 시스템의 시작점)가 포함되어 있는 영역
    
    - 최상위 디렉터리에는 모든 파일과 하위 디렉터리의 정보가 기록된다
    - FAT12와 FAT16에서는 루트 디렉터리의 크기가 고정되어 있지만 FAT32에서는 데이터 영역으로 위치하며 동적 확장이 가능했다
- 데이터 영역
    
    : 실제 파일 데이터가 저장되는 영역
    
    - FAT 테이블은 데이터 영역에서 사용중인 블럭과 비어 있는 블럭을 추적하며 파일의 각 부분이 데이터의 어떤 블록에 저장되어 있는지 기록한다
    - 데이터 영역은 여러개의 블록(클러스터)으로 나뉘며, 각 블록은 여러개의 섹터로 이뤄져 있다.
        - 작은 파일이라도 전체 클러스터를 차지하기 때문에 작은 파일이 많을 경우 클러스터의 크기를 선택하는 것이 중요하다 (FAT 파일 시스템의 한계)
- 파일 속성 정보는 디렉터리 엔트리에 표현된다
(파일 이름, 확장자, 속성, 예약 영역, 생성 시간, 마지막 접근 시간, 마지막 수정 시간, 시작 블록, 파일 크기)

### 유닉스 파일 시스템

- 불연속 파일 할당 > 색인 할당 방식을 채택한 파일 시스템
- i-node는 파티션 내의 특정 영역 (i-node 영역)에 모여 있으며, 디렉터리와 파일은 데이터 영역에 존재한다.
- 유닉스 파일 시스템은 루트 디렉터리의 i-node를 항상 기억하고 있다
- i-node (index-node) : 유닉스 파일 시스템에서의 색인 블록을 지칭하는 말
    - i-node에는 파일 속성 정보와 열다섯개의 블록 주소가 저장될 수 있다
        - 파일 속성 정보 : 파일 크기, 생성 시간, 마지막 접근 시간, 마지막 수정 시간, 소유자 등
        - 15개의 블록 주소
            - 0번 ~ 11번 블록 주소 : 직접 블록(파일 데이터가 저장된 블록) 주소 직접 명시
            - 12번 블록 주소 : 단일 간접 블록(직접 블록 주소가 저장된 블록) 주소 명시
            - 13번 블록 주소 : 이중 간접 블록(단일 간접 블록들의 주소를 저장한 블록) 주소 명시
            - 14번째 블록 주소 : 삼중 간접 블록(이중 간접 블록들의 주소를 저장한 블록) 주소 명시
    - 유닉스 파일 시스템에서 파일 속성 정보는 i-node에 표현된다
    (파일 크기, 생성 시간, 마지막 접근 시간, 마지막 수정 시간, 소유자 등)
    - 파일마다 i-node가 존재하며, i-node마다 번호가 부여되어 있다.
        
        루트 디렉터린
        
- 데이터 영역
    - 실질적인 파일과 디렉터리가 존재하는 영역
- 파일 속성 정보는 i-node에 존재한다.
(i-node가 파일의 모든 것을 담고 있다)
- 디렉터리 엔트리에는 파일 이름과 i-node 번호로 구성된다
# 12-1 동기화란

프로세스들은 실행 순서와 자원의 일관성을 보장하기 위해서 동기화(`Synchronization`)이 되어야 합니다.

## 동기화의 의미
프로세스 동기화란?
프로세스들 사이의 수행 시기를 맞추는 것을 의미합니다.
동기화는 다음과 같습니다.
1. 실행 순서 제어를 위한 동기화
2. 상호 배제를 위한 동기화

### 실행 순서 제어를 위한 동기화

두 개의 프로세스가 동시에 실행 중입니다. 한 개의 파일을 불러오는 프로세스를 가정합니다. 동시에 실행 되는 순서가 올바른 순서대로 실행이 되는 것을 실행 순서 제어 동기화라고 합니다.

### 상호 배제를 위한 동기화
상호 배제(`mutual exclusion`)는 공유가 불가능한 자원의 동시 사용을 피하기 위해 사용되는 알고리즘입니다.
동시에 접근해서는 안 되는 자원에 동시에 접근하지 못하게 하는 것을 상호 배제를 위한 동기화라고 합니다.


## 공유 자원과 임계 구역
동시에 접근해서는 안 되는 자원이 무엇일까요?
공유 자원 중에서 두 개 이상의 프로세스를 동시에 실행하면 문제가 발생하는 자원이 있습니다.
동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역을 임계 구역이라고 합니다.
잘못된 실행으로 인해 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우가 있습니다. 이를 레이스 컨디션이라고 합니다.

운영체제에서는 임계 구역 문제를 세 가지 원칙 하에 해결합니다.
1. 상호배제
2. 진행
3. 유한 대기

# 12-1 동기화 기법
프로세스 동기화는 어떻게 이뤄질까요? 임계 구역에서 오직 하나의 프로세스만 진입하게 하고, 올바른 실행 순서를 보장할 수 있어야 합니다.

## 뮤텍스 락
뮤텍스 락(`Mutex lock`)은 동시에 접근해서는 안 되는 자원에 동시에 접근하지 못 하도록 만드는 도구입니다.
뮤텍스 락은 하나의 전역 변수와 두 함수로 구현할 수 있습니다.

- 자물쇠 역할 : lock
- 임계 구역을 잠그는 역할 : acquire 함수
- 임계 구역의 잠금을 해체하는 역할 : release 함수

**acquire 함수**는 프로세스가 임계 구역에 진입하기 전에 호출하는 함수입니다.

**release 함수**는 임계 구역에서의 작업이 끝나고 호출하는 함수입니다.

```java
acquire();
// 임계 구역
release();
```

그러나 계속 안에 자물쇠가 채워져있는지 확인해야하기때문에 바쁜 대기라고 한다. 

## 세마포
세마포(`Semaphore`)는 공유 자원이 **여러 개** 있는 상황에서도 적용이 가능한 동기화 도구입니다.

- 임계 구역에 진입할 수 있는 프로세스의 개수 **전역변수 S**
- 임계 구역에 들어가도 좋을지 말지 알려주는 **wait함수**
- 임계 구역 앞에서 기다리는 프로세스를 알려주는 신호 **signal 함수**
```java
wait()
// 임계 구역
signal()
```

만약 사용할 수 있는 공유 자원이 없는 경우 프로세스는 무작정 무한히 반복하며 S(전역 변수)를 기달려야 합니다.
이 경우에는 다음과 같습니다.
1. wait 함수는 만일 사용할 수 있는 자원이 없을 경우 해당 프로세스 상태를 대기 상태로 만듭니다.
2. 그 프로세스의 PCB를 세마포를 위한 대기 큐에 집어넣습니다.
3. 다른 프로세스가 임계 구역에서의 작업이 끝나고 signal 함수를 호출합니다.
4. signal 함수는 대기 중인 프로세스를 대기 큐에서 제거합니다. 
5. 프로세스 상태를 준비 상태로 변경한 뒤 준비 큐로 옮깁니다.

## 모니터
모니터 동기화 도구는 공유 자원과 공유 자원에 접근하기 위한 인터페이스를 묶어 관리하는 도구입니다.
프로세스는 반드시 인터페이스를 통해서만 공유 자원에 접근하도록 합니다.

모니터를 통해 공유 자원에 접근하고자 하는 프로세스를 큐에 삽입하고, 큐에 삽입된 순서대로 하나씩 공유 자원을 이용하도록 합니다. 모니터 안에 항상 하나의 프로세스만 들어오도록 하여 상호배제를 위한 동기화를 제공합니다.


## 파일
파일(`file`)이란 하드 디스크나 SSD와 같은 보조기억장치에 저장 관련 정보의 집합

모든 파일에는 이름과 파일을 실행하기 위한 정보, 파일 관련 부가 정보가 있습니다.
	- 부가 정보 : 속성, 메타데이터
파일 형식, 위치, 크기 등 파일 관련된 정보를 파일 속성이라고 합니다.

### 파일 속성과 유형
운영체제, 파일 시스템은 파일별로 유지하고 관리합니다.
- 파일 유형 : 운영체제가 인식하는 파일 종류
- 파일 유형을 알리기 위해 사용하는 방식: 확장자(`extension`) 이용

### 파일 연산을 위한 시스템 호출
어떤 응용 프로그램도 임의로 파일을 조작할 수 없으며 파일을 다루려면 운영체제가 있어야 합니다.

## 디렉토리
파일들을 일목요현하게 관리하기 위해 디렉토리(`directory`)를 사용합니다. 디렉토리를 폴더(`Folder`)라고 부릅니다.
여러 계층을 가진 트리 구조 디렉토리(`tree-structured directory`)가 생겼습니다.
최상의 디렉터리를 루트 디렉토리(`root directory`)라고 부릅니다.  슬래시(`/`)로 표현합니다.

경로(`Path`)는 디렉토리를 이용해 파일 위치, 파일 이름을 특정 짓는 정보입니다.

### 절대 경로와 상대 경로
모든 파일은 루트 디렉터리에서 자기 자신까지 이르는 고유한 경로를 가진 경로를 절대 경로(`absolute path`)라고 부릅니다.
절대 경로가 루트 디렉토리부터 시작 하는 경로라면 상대 경로(`relative path`)현재 디렉토리 부터 시작하는 경로 입니다.

# 파일과 디렉토리
## 파일
파일(`file`)이란 하드 디스크나 SSD와 같은 보조기억장치에 저장 관련 정보의 집합

모든 파일에는 이름과 파일을 실행하기 위한 정보, 파일 관련 부가 정보가 있습니다.
	- 부가 정보 : 속성, 메타데이터
파일 형식, 위치, 크기 등 파일 관련된 정보를 파일 속성이라고 합니다.

### 파일 속성과 유형
운영체제, 파일 시스템은 파일별로 유지하고 관리합니다.
- 파일 유형 : 운영체제가 인식하는 파일 종류
- 파일 유형을 알리기 위해 사용하는 방식: 확장자(`extension`) 이용

### 파일 연산을 위한 시스템 호출
어떤 응용 프로그램도 임의로 파일을 조작할 수 없으며 파일을 다루려면 운영체제가 있어야 합니다.

## 디렉토리
파일들을 일목요현하게 관리하기 위해 디렉토리(`directory`)를 사용합니다. 디렉토리를 폴더(`Folder`)라고 부릅니다.
여러 계층을 가진 트리 구조 디렉토리(`tree-structured directory`)가 생겼습니다.
최상의 디렉터리를 루트 디렉토리(`root directory`)라고 부릅니다.  슬래시(`/`)로 표현합니다.

경로(`Path`)는 디렉토리를 이용해 파일 위치, 파일 이름을 특정 짓는 정보입니다.

### 절대 경로와 상대 경로
모든 파일은 루트 디렉터리에서 자기 자신까지 이르는 고유한 경로를 가진 경로를 절대 경로(`absolute path`)라고 부릅니다.
절대 경로가 루트 디렉토리부터 시작 하는 경로라면 상대 경로(`relative path`)현재 디렉토리 부터 시작하는 경로 입니다.


# 15-2 파일 시스템
파일 시스템은 파일과 디렉터리를 보조기억장치에 일목요연하게 저장하고 접근할 수 있게 하는 운영체제 내부 프로그램입니다.
파일 시스템인 FAT 파일 시스템과 유닉스 파일 시스템에 대해서 알아봅시다.

## 파티셔닝과 포매팅
보조기억장치에 곧바로 파일을 저장할 수 없습니다. 그래서 보조기억장치에 사용하려면 파티션을 나누고 작업(`파티셔닝`)과 포맷 작업(`포매팅`)을 거쳐야 합니다.

파티셔닝(`Partitioning`)은 저장 장치의 논리적인 영역을 구획하는 작업을 의미합니다.
칸막이로 영역을 나누는 작업이 파티셔닝입니다. 파티셔닝 작업을 통해 누어진 영역 하나하나를 파티션(`partition`)이라고 합니다.

포매팅(`formatting`)이란 파일 시스템을 설정하여 어떤 방식으로 파일을 저장하고 관리할 것인지를 결정하고, 새로운 데이터를 쓸 준비를 하는 작업을 의미합니다.

포매팅은 파일 시스템이 결정합니다.

## 파일 할당 방법
운영체제는 파일과 디렉터리를 블록(`block`)단위로 읽고 씁니다.
파일을 보조기억장치에 할당하는 방법은 두 가지가 있습니다. 연속 할당과 불연속 할당이 있습니다. 불연속 할당에는 크게 연결 할당, 색인 할당이 있습니다.

### 연속 할당
연속 할당은 단순한 방법입니다. 보조기억장치 내 연속적인 블록 파일을 할당하는 방식입니다.
외부 단편화를 야기하는 단점이 있습니다.

### 연결 할당
연속 할당의 문제를 해결할 수 있는 방식이 연결 할당(`linked allocation`)이 있습니다. 
연결 할당은 각 블록 일부에 다음 블록의 주소를 저장하여 각 블록이 다음 블록을 가리키는 형태로 할당하는 방식입니다.

연결 할당은 외부 단편화 문제를 해결하지만 단점이 있습니다.

### 색인 할당
색인 할당(`indexed allocation`)은 파일의 모든 블록 주소를 색인 블록(`index block`)이라는 하나의 블록에 모아 관리하는 방식입니다.
색인 할당을 사용하는 파일 시스템에서는 디렉터리 엔트리에 파일 이름과 더불어 색인블록주소를 명시합니다.

## 파일 시스템 살펴보기
USB 메모리, SD 카드 등의 저용량 저장 장치에서는 FAT 파일 시스템이고 유닉스 계열 운영체제에서는 유닉스 파일 시스템입니다.
### FAT 파일 시스템
연결 할당의 단점을 보완할 파일 시스템 FAT 파일 시스템입니다.
테이블을 파일 할당 테이블(`FAT: File Allocation Table`)이라고 부릅니다.
FAT를 이용하는 파일 시스템이 바로 FAT 파일 시스템입니다.
FAT 파일 시스템의 디렉터리 엔트리에는 파일 이름과 더불어 파일의 첫 번째 블록 주소가 명시된다고 합니다.

### 유닉스 파일 시스템
파일 시스템은 색인 할당 기반 유닉스 파일 시스템입니다.
유닉스 파일 시스템에서는 이 색인 블록을 i-node(`idex-node`)라고 부릅니다.

유닉스 파일 시스템에는 파일마다 이러한 i-node가 있고, i-node마다 번호가 부여됩니다.

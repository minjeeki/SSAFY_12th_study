# 12-1 동기화란

프로세스들은 실행 순서와 자원의 일관성을 보장하기 위해서 동기화(`Synchronization`)이 되어야 합니다.

## 동기화의 의미
프로세스 동기화란?
프로세스들 사이의 수행 시기를 맞추는 것을 의미합니다.
동기화는 다음과 같습니다.
1. 실행 순서 제어를 위한 동기화
2. 상호 배제를 위한 동기화

### 실행 순서 제어를 위한 동기화

두 개의 프로세스가 동시에 실행 중입니다. 한 개의 파일을 불러오는 프로세스를 가정합니다. 동시에 실행 되는 순서가 올바른 순서대로 실행이 되는 것을 실행 순서 제어 동기화라고 합니다.

### 상호 배제를 위한 동기화
상호 배제(`mutual exclusion`)는 공유가 불가능한 자원의 동시 사용을 피하기 위해 사용되는 알고리즘입니다.
동시에 접근해서는 안 되는 자원에 동시에 접근하지 못하게 하는 것을 상호 배제를 위한 동기화라고 합니다.


## 공유 자원과 임계 구역
동시에 접근해서는 안 되는 자원이 무엇일까요?
공유 자원 중에서 두 개 이상의 프로세스를 동시에 실행하면 문제가 발생하는 자원이 있습니다.
동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역을 임계 구역이라고 합니다.
잘못된 실행으로 인해 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우가 있습니다. 이를 레이스 컨디션이라고 합니다.

운영체제에서는 임계 구역 문제를 세 가지 원칙 하에 해결합니다.
1. 상호배제
2. 진행
3. 유한 대기

# 12-1 동기화 기법
프로세스 동기화는 어떻게 이뤄질까요? 임계 구역에서 오직 하나의 프로세스만 진입하게 하고, 올바른 실행 순서를 보장할 수 있어야 합니다.

## 뮤텍스 락
뮤텍스 락(`Mutex lock`)은 동시에 접근해서는 안 되는 자원에 동시에 접근하지 못 하도록 만드는 도구입니다.
뮤텍스 락은 하나의 전역 변수와 두 함수로 구현할 수 있습니다.

- 자물쇠 역할 : lock
- 임계 구역을 잠그는 역할 : acquire 함수
- 임계 구역의 잠금을 해체하는 역할 : release 함수

**acquire 함수**는 프로세스가 임계 구역에 진입하기 전에 호출하는 함수입니다.

**release 함수**는 임계 구역에서의 작업이 끝나고 호출하는 함수입니다.

```java
acquire();
// 임계 구역
release();
```

## 세마포
세마포(`Semaphore`)는 공유 자원이 여러 개 있는 상황에서도 적용이 가능한 동기화 도구입니다.

- 임계 구역에 진입할 수 있는 프로세스의 개수 **전역변수 S**
- 임계 구역에 들어가도 좋을지 말지 알려주는 **wait함수**
- 임계 구역 앞에서 기다리는 프로세스를 알려주는 신호 **signal 함수**
```java
wait()
// 임계 구역
signal()
```

만약 사용할 수 있는 공유 자원이 없는 경우 프로세스는 무작정 무한히 반복하며 S(전역 변수)를 기달려야 합니다.
이 경우에는 다음과 같습니다.
1. wait 함수는 만일 사용할 수 있는 자원이 없을 경우 해당 프로세스 상태를 대기 상태로 만듭니다.
2. 그 프로세스의 PCB를 세마포를 위한 대기 큐에 집어넣습니다.
3. 다른 프로세스가 임계 구역에서의 작업이 끝나고 signal 함수를 호출합니다.
4. signal 함수는 대기 중인 프로세스를 대기 큐에서 제거합니다. 
5. 프로세스 상태를 준비 상태로 변경한 뒤 준비 큐로 옮깁니다.

## 모니터
모니터 동기화 도구는 공유 자원과 공유 자원에 접근하기 위한 인터페이스를 묶어 관리하는 도구입니다.
프로세스는 반드시 인터페이스를 통해서만 공유 자원에 접근하도록 합니다.

모니터를 통해 공유 자원에 접근하고자 하는 프로세스를 큐에 삽입하고, 큐에 삽입된 순서대로 하나씩 공유 자원을 이용하도록 합니다. 모니터 안에 항상 하나의 프로세스만 들어오도록 하여 상호배제를 위한 동기화를 제공합니다.
